<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Look Up Time Zones of Point Coordinates • lutz</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Look Up Time Zones of Point Coordinates">
<meta property="og:description" content="Input latitude and longitude values or an 'sf/sfc' POINT 
    object and get back the timezone in which they exist. Two methods are implemented. 
    One is very fast and uses 'Rcpp' in conjunction with data from the 'Javascript' library
    (&lt;https://github.com/darkskyapp/tz-lookup/&gt;). This method also works outside of countries' 
    borders and in international waters, however speed comes at the cost of accuracy - near time 
    zone borders away from populated centres there is a chance that it will return the incorrect
    time zone. The other method is slower but more accurate - it uses the 'sf' package to intersect 
    points with a detailed map of time zones from here: 
    &lt;https://github.com/evansiroky/timezone-boundary-builder/&gt;.">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">lutz</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.2.0.999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->
<!-- badges: start -->

<div id="lutz-look-up-timezones" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#lutz-look-up-timezones" class="anchor"></a>lutz (look up timezones)</h1></div>
<div id="lookup-the-timezone-of-coordinates" class="section level2">
<h2 class="hasAnchor">
<a href="#lookup-the-timezone-of-coordinates" class="anchor"></a>Lookup the timezone of coordinates</h2>
<p>Input latitude and longitude values or an <code>sf/sfc</code> POINT object and get back the timezone in which they exist. Two methods are implemented. One is very fast and uses Rcpp in conjunction with source data from (<a href="https://github.com/darkskyapp/tz-lookup/" class="uri">https://github.com/darkskyapp/tz-lookup/</a>). However, speed comes at the cost of accuracy - near time zone borders away from populated centres there is a chance that it will return the incorrect time zone.</p>
<p>The other method is slower but more accurate - it uses the sf package to intersect points with a detailed map of time zones from <a href="https://github.com/evansiroky/timezone-boundary-builder">here</a>.</p>
</div>
<div id="timezone-utility-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#timezone-utility-functions" class="anchor"></a>Timezone utility functions</h2>
<p><strong>lutz</strong> also contains several utility functions for helping to understand and visualize timezones, such as listing of world timezones,including information about daylight savings times and their offsets from UTC. You can also plot a timezone to visualize the UTC offset over a year and when daylight savings times are in effect.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install lutz from CRAN with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"lutz"</span>)</span></code></pre></div>
<p>Or you can install the development version from github with:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># install.packages("devtools")</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"ateucher/lutz"</span>)</span></code></pre></div>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<p>There are two functions in this package for looking up the timezones of coordinates: <code><a href="reference/tz_lookup.html">tz_lookup()</a></code> which works with both <code>sf/sfc</code> and <code>SpatialPoints</code> objects, and <code>tz_lookup_coords</code> for looking up lat/long pairs. Use the <code>method</code> argument to choose the <code>"fast"</code> or <code>"accurate"</code> method.</p>
<div id="with-coordinates--they-must-be-latlong-in-decimal-degrees" class="section level3">
<h3 class="hasAnchor">
<a href="#with-coordinates--they-must-be-latlong-in-decimal-degrees" class="anchor"></a>With coordinates. They must be lat/long in decimal degrees:</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(lutz)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw"><a href="reference/tz_lookup_coords.html">tz_lookup_coords</a></span>(<span class="fl">49.5</span>, <span class="fl">-123.5</span>, <span class="dt">method =</span> <span class="st">"fast"</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">#&gt; [1] "America/Vancouver"</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="kw"><a href="reference/tz_lookup_coords.html">tz_lookup_coords</a></span>(<span class="fl">49.5</span>, <span class="fl">-123.5</span>, <span class="dt">method =</span> <span class="st">"accurate"</span>)</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">#&gt; [1] "America/Vancouver"</span></span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="kw"><a href="reference/tz_lookup_coords.html">tz_lookup_coords</a></span>(<span class="dt">lat =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">48.9</span>, <span class="fl">38.5</span>, <span class="fl">63.1</span>, <span class="dv">-25</span>), <span class="dt">lon =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="fl">123.5</span>, <span class="fl">-110.2</span>, <span class="fl">-95.0</span>, <span class="dv">130</span>))</span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt; [1] "America/Vancouver"    "America/Denver"       "America/Rankin_Inlet"</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt; [4] "Australia/Darwin"</span></span></code></pre></div>
</div>
<div id="with-sf-objects" class="section level3">
<h3 class="hasAnchor">
<a href="#with-sf-objects" class="anchor"></a>With <code>sf</code> objects:</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sf)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2) <span class="co"># this requires the devlopment version of ggplot2</span></span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co"># Create an sf object out of the included state.center dataset:</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>pts &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/lapply">lapply</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_along</a></span>(state.center<span class="op">$</span>x), <span class="cf">function</span>(i) {</span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st">st_point</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(state.center<span class="op">$</span>x[i], state.center<span class="op">$</span>y[i]))</span>
<span id="cb4-7"><a href="#cb4-7"></a>})</span>
<span id="cb4-8"><a href="#cb4-8"></a>state_centers_sf &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/sf">st_sf</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/sfc">st_sfc</a></span>(pts))</span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co"># Use tz_lookup_sf to find the timezones</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>state_centers_sf<span class="op">$</span>tz &lt;-<span class="st"> </span><span class="kw"><a href="reference/tz_lookup.html">tz_lookup</a></span>(state_centers_sf)</span>
<span id="cb4-12"><a href="#cb4-12"></a>state_centers_sf<span class="op">$</span>tz &lt;-<span class="st"> </span><span class="kw"><a href="reference/tz_lookup.html">tz_lookup</a></span>(state_centers_sf, <span class="dt">method =</span> <span class="st">"accurate"</span>)</span>
<span id="cb4-13"><a href="#cb4-13"></a></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span>(<span class="dt">data =</span> state_centers_sf, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">colour =</span> tz)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">coord_sf</a></span>(<span class="dt">datum =</span> <span class="ot">NA</span>)</span></code></pre></div>
<p><img src="reference/figures/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div id="with-spatialpoints-objects" class="section level3">
<h3 class="hasAnchor">
<a href="#with-spatialpoints-objects" class="anchor"></a>With <code>SpatialPoints</code> objects:</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sp)</span>
<span id="cb5-2"><a href="#cb5-2"></a>state_centers_sp &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/coerce-methods">as</a></span>(state_centers_sf, <span class="st">"Spatial"</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a>state_centers_sp<span class="op">$</span>tz &lt;-<span class="st"> </span><span class="kw"><a href="reference/tz_lookup.html">tz_lookup</a></span>(state_centers_sp)</span>
<span id="cb5-5"><a href="#cb5-5"></a></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(state_centers_sp)), <span class="dt">tz =</span> state_centers_sp<span class="op">$</span>tz), </span>
<span id="cb5-7"><a href="#cb5-7"></a>       <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> coords.x1, <span class="dt">y =</span> coords.x2, <span class="dt">colour =</span> tz)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span>()</span></code></pre></div>
<p><img src="reference/figures/unnamed-chunk-5-1.png" width="700"></p>
<p>Note that there are some regions in the world where a single point can land in two different overlapping timezones. The <code>"accurate"</code> method <a href="https://github.com/evansiroky/timezone-boundary-builder/releases/tag/2018g">includes these</a>, however the method used in the <code>"fast"</code> does not include overlapping timezones (<a href="https://github.com/darkskyapp/tz-lookup/issues/34">at least for now</a>).</p>
<p>We can compare the accuracy of both methods to the high-resolution timezone map provided by <a href="https://github.com/evansiroky/timezone-boundary-builder" class="uri">https://github.com/evansiroky/timezone-boundary-builder</a>. This is the map that is used by <code>lutz</code> for the <code>"accurate"</code> method, but in <code>lutz</code> it is simplified by about 80% to be small enough to fit in the package.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co">## Get the full timezone geojson from https://github.com/evansiroky/timezone-boundary-builder</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/download.file">download.file</a></span>(<span class="st">"https://github.com/evansiroky/timezone-boundary-builder/releases/download/2019a/timezones-with-oceans.geojson.zip"</span>,</span>
<span id="cb6-3"><a href="#cb6-3"></a>                <span class="dt">destfile =</span> <span class="st">"tz.zip"</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/unzip">unzip</a></span>(<span class="st">"tz.zip"</span>, <span class="dt">exdir =</span> <span class="st">"data-raw/dist/"</span>)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(lutz)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sf)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(purrr)</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">#&gt; </span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt; </span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt;     filter, lag</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">#&gt; </span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span id="cb7-13"><a href="#cb7-13"></a></span>
<span id="cb7-14"><a href="#cb7-14"></a>tz_full &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_read">read_sf</a></span>(<span class="st">"data-raw/dist/combined-with-oceans.json"</span>)</span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co"># Create a data frame of 500000 lat/long pairs:</span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">1</span>)</span>
<span id="cb7-17"><a href="#cb7-17"></a>n &lt;-<span class="st"> </span><span class="dv">500000</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>ll &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">id =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(n), <span class="dt">lat =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(n, <span class="dv">-90</span>, <span class="dv">90</span>), <span class="dt">lon =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Uniform">runif</a></span>(n, <span class="dv">-180</span>, <span class="dv">180</span>))</span>
<span id="cb7-19"><a href="#cb7-19"></a>ll_sf &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_as_sf">st_as_sf</a></span>(ll, <span class="dt">coords =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="dt">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb7-20"><a href="#cb7-20"></a></span>
<span id="cb7-21"><a href="#cb7-21"></a><span class="co"># Overlay those points with the full high-resolution timezone map:</span></span>
<span id="cb7-22"><a href="#cb7-22"></a>ref_ll_tz &lt;-<span class="st"> </span>sf<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_join">st_join</a></span>(ll_sf, tz_full)</span>
<span id="cb7-23"><a href="#cb7-23"></a><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects assumes that they are planar</span></span>
<span id="cb7-24"><a href="#cb7-24"></a><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects assumes that they are planar</span></span>
<span id="cb7-25"><a href="#cb7-25"></a></span>
<span id="cb7-26"><a href="#cb7-26"></a><span class="co"># Combine those that had overlapping timezones</span></span>
<span id="cb7-27"><a href="#cb7-27"></a>ref_ll_tz &lt;-<span class="st"> </span>ref_ll_tz <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-28"><a href="#cb7-28"></a><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_set_geometry</a></span>(<span class="ot">NULL</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-29"><a href="#cb7-29"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(id) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-30"><a href="#cb7-30"></a><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="dt">tzid =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(tzid, <span class="dt">collapse =</span> <span class="st">"; "</span>))</span>
<span id="cb7-31"><a href="#cb7-31"></a></span>
<span id="cb7-32"><a href="#cb7-32"></a><span class="co"># run tz_lookup with both `"fast"` and `"accurate"` methods and compare with </span></span>
<span id="cb7-33"><a href="#cb7-33"></a><span class="co"># the timezones looked up with the high-resolution map:</span></span>
<span id="cb7-34"><a href="#cb7-34"></a>tests &lt;-<span class="st"> </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"fast"</span>, <span class="st">"accurate"</span>), <span class="op">~</span><span class="st"> </span>{</span>
<span id="cb7-35"><a href="#cb7-35"></a>  time &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.time">system.time</a></span>(test_ll_tz &lt;-<span class="st"> </span><span class="kw"><a href="reference/tz_lookup.html">tz_lookup</a></span>(ll_sf, <span class="dt">method =</span> .x, <span class="dt">warn =</span> <span class="ot">FALSE</span>))</span>
<span id="cb7-36"><a href="#cb7-36"></a>  comp &lt;-<span class="st"> </span>ref_ll_tz<span class="op">$</span>tzid <span class="op">==</span><span class="st"> </span>test_ll_tz</span>
<span id="cb7-37"><a href="#cb7-37"></a>  matches &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(comp, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb7-38"><a href="#cb7-38"></a>  mismatches &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(<span class="op">!</span>comp, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb7-39"><a href="#cb7-39"></a>  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(</span>
<span id="cb7-40"><a href="#cb7-40"></a>    <span class="dt">method =</span> .x,</span>
<span id="cb7-41"><a href="#cb7-41"></a>    <span class="dt">time =</span> time[<span class="st">"elapsed"</span>],</span>
<span id="cb7-42"><a href="#cb7-42"></a>    <span class="dt">matches =</span> matches,</span>
<span id="cb7-43"><a href="#cb7-43"></a>    <span class="dt">mismatches =</span> mismatches,</span>
<span id="cb7-44"><a href="#cb7-44"></a>    <span class="dt">accuracy =</span> matches <span class="op">/</span><span class="st"> </span>(matches <span class="op">+</span><span class="st"> </span>mismatches),</span>
<span id="cb7-45"><a href="#cb7-45"></a>    <span class="dt">ref_nas =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(ref_ll_tz<span class="op">$</span>tzid)),</span>
<span id="cb7-46"><a href="#cb7-46"></a>    <span class="dt">fun_nas =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(test_ll_tz))</span>
<span id="cb7-47"><a href="#cb7-47"></a>    )</span>
<span id="cb7-48"><a href="#cb7-48"></a>})</span>
<span id="cb7-49"><a href="#cb7-49"></a><span class="co">#&gt; Warning in tz_lookup_accurate.sf(x, crs): Some points are in areas with</span></span>
<span id="cb7-50"><a href="#cb7-50"></a><span class="co">#&gt; more than one timezone defined.These are often disputed areas and should be</span></span>
<span id="cb7-51"><a href="#cb7-51"></a><span class="co">#&gt; treated with care.</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(tests)</span></code></pre></div>
<table class="table table">
<thead><tr class="header">
<th align="left">method</th>
<th align="right">time</th>
<th align="right">matches</th>
<th align="right">mismatches</th>
<th align="right">accuracy</th>
<th align="right">ref_nas</th>
<th align="right">fun_nas</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">fast</td>
<td align="right">1.027</td>
<td align="right">371946</td>
<td align="right">128054</td>
<td align="right">0.743892</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">accurate</td>
<td align="right">21.782</td>
<td align="right">499949</td>
<td align="right">51</td>
<td align="right">0.999898</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="timezone-utility-functions-1" class="section level2">
<h2 class="hasAnchor">
<a href="#timezone-utility-functions-1" class="anchor"></a>Timezone utility functions</h2>
<div id="plot_tz" class="section level3">
<h3 class="hasAnchor">
<a href="#plot_tz" class="anchor"></a><code><a href="reference/plot_tz.html">plot_tz()</a></code>
</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw"><a href="reference/plot_tz.html">plot_tz</a></span>(<span class="st">"America/Vancouver"</span>)</span></code></pre></div>
<p><img src="reference/figures/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div id="tz_offset" class="section level3">
<h3 class="hasAnchor">
<a href="#tz_offset" class="anchor"></a><code><a href="reference/tz_offset.html">tz_offset()</a></code>
</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># A Date object</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="kw"><a href="reference/tz_offset.html">tz_offset</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.Date</a></span>(), <span class="st">"Africa/Algiers"</span>)</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="co">#&gt;          tz_name  date_time zone is_dst utc_offset_h</span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co">#&gt; 1 Africa/Algiers 2019-07-12  CET  FALSE            1</span></span>
<span id="cb10-5"><a href="#cb10-5"></a></span>
<span id="cb10-6"><a href="#cb10-6"></a></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="co"># A Date-like character string</span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="kw"><a href="reference/tz_offset.html">tz_offset</a></span>(<span class="st">"2017-03-01"</span>, <span class="dt">tz =</span> <span class="st">"Singapore"</span>)</span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co">#&gt;     tz_name  date_time zone is_dst utc_offset_h</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="co">#&gt; 1 Singapore 2017-03-01  +08  FALSE            8</span></span>
<span id="cb10-11"><a href="#cb10-11"></a></span>
<span id="cb10-12"><a href="#cb10-12"></a></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="co"># A POSIXct date-time object</span></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="kw"><a href="reference/tz_offset.html">tz_offset</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.time</a></span>())</span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="co">#&gt; Warning: You supplied an object of class POSIXct that does not have a</span></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="co">#&gt; timezone attribute, and did not specify one inthe 'tz' argument. Defaulting</span></span>
<span id="cb10-17"><a href="#cb10-17"></a><span class="co">#&gt; to current (America/Vancouver).</span></span>
<span id="cb10-18"><a href="#cb10-18"></a><span class="co">#&gt;             tz_name           date_time zone is_dst utc_offset_h</span></span>
<span id="cb10-19"><a href="#cb10-19"></a><span class="co">#&gt; 1 America/Vancouver 2019-07-12 13:07:22  PDT   TRUE           -7</span></span></code></pre></div>
</div>
<div id="tz_list" class="section level3">
<h3 class="hasAnchor">
<a href="#tz_list" class="anchor"></a><code><a href="reference/tz_list.html">tz_list()</a></code>
</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw"><a href="reference/tz_list.html">tz_list</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="dv">20</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</span></code></pre></div>
<table class="table table">
<thead><tr class="header">
<th align="left">tz_name</th>
<th align="left">zone</th>
<th align="left">is_dst</th>
<th align="right">utc_offset_h</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Africa/Abidjan</td>
<td align="left">GMT</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Africa/Accra</td>
<td align="left">GMT</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Africa/Addis_Ababa</td>
<td align="left">EAT</td>
<td align="left">FALSE</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Africa/Algiers</td>
<td align="left">CET</td>
<td align="left">FALSE</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Africa/Asmara</td>
<td align="left">EAT</td>
<td align="left">FALSE</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">Africa/Asmera</td>
<td align="left">EAT</td>
<td align="left">FALSE</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">Africa/Bamako</td>
<td align="left">GMT</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Africa/Bangui</td>
<td align="left">WAT</td>
<td align="left">FALSE</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Africa/Banjul</td>
<td align="left">GMT</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Africa/Bissau</td>
<td align="left">GMT</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Africa/Blantyre</td>
<td align="left">CAT</td>
<td align="left">FALSE</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Africa/Brazzaville</td>
<td align="left">WAT</td>
<td align="left">FALSE</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Africa/Bujumbura</td>
<td align="left">CAT</td>
<td align="left">FALSE</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Africa/Cairo</td>
<td align="left">EET</td>
<td align="left">FALSE</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Africa/Casablanca</td>
<td align="left">+01</td>
<td align="left">FALSE</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Africa/Casablanca</td>
<td align="left">+00</td>
<td align="left">TRUE</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Africa/Ceuta</td>
<td align="left">CET</td>
<td align="left">FALSE</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Africa/Ceuta</td>
<td align="left">CEST</td>
<td align="left">TRUE</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">Africa/Conakry</td>
<td align="left">GMT</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Africa/Dakar</td>
<td align="left">GMT</td>
<td align="left">FALSE</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=lutz">https://​cloud.r-project.org/​package=lutz</a>
</li>
<li>Report a bug at <br><a href="https://github.com/ateucher/lutz/issues">https://​github.com/​ateucher/​lutz/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Andy Teucher <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-7840-692X" target="orcid.widget"><img src="https://members.orcid.org/sites/default/files/vector_iD_icon.svg" class="orcid" alt="ORCID" height="16"></a> </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

      <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.org/ateucher/lutz"><img src="https://travis-ci.org/ateucher/lutz.svg?branch=master" alt="Travis-CI Build Status"></a></li>
<li><a href="https://ci.appveyor.com/project/ateucher/lutz"><img src="https://ci.appveyor.com/api/projects/status/github/ateucher/lutz?branch=master&amp;svg=true" alt="AppVeyor Build Status"></a></li>
<li><a href="https://codecov.io/github/ateucher/lutz?branch=master"><img src="https://img.shields.io/codecov/c/github/ateucher/lutz/master.svg" alt="Coverage Status"></a></li>
<li><a href="https://cran.r-project.org/package=lutz"><img src="https://www.r-pkg.org/badges/version/lutz" alt="CRAN status"></a></li>
<li><a href="https://cran.r-project.org/package=lutz"><img src="https://cranlogs.r-pkg.org/badges/lutz" alt="CRAN downloads"></a></li>
</ul>
</div>
</div>

</div>


      <footer><div class="copyright">
  <p>Developed by Andy Teucher.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
